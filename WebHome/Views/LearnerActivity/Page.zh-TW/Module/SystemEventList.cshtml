@using System.IO
@using System.Linq.Expressions
@using System.Text
@using System.Net
@using System.Net.Mail
@using Microsoft.AspNetCore.Mvc.ModelBinding
@using Microsoft.Extensions.Logging

@using WebHome.Helper
@using WebHome.Models.Locale
@using WebHome.Models.ViewModel
@using WebHome.Models.DataEntity
@using WebHome.Controllers
@using CommonLib.Utility
@using Newtonsoft.Json
@using Newtonsoft.Json.Linq
@using WebHome.Models.Resources
@using WebHome.Properties;

@{

    ModelSource<UserProfile> models;
    ModelStateDictionary _modelState;

    models = (ModelSource<UserProfile>)ViewContext.HttpContext.Items["Models"]; ;
    _modelState = ViewContext.ModelState;

    String lang = ViewBag.Lang ?? "zh-TW";
    var langPath = lang == "zh-TW"
    ? "tw"
    : lang == "en-US"
    ? "en"
    : "ja";

    //await Html.RenderPartialAsync("~/Views/LearnerActivity/Template/GlobalResource.cshtml");
    //dynamic globalResource = ViewContext.HttpContext.Items["GlobalResource"] as dynamic;

    var profile = await Context.GetUserAsync();
    IQueryable<SystemEventBulletin> _model = (IQueryable<SystemEventBulletin>)this.Model;

}

@foreach (var item in _model)
{
    String actionPath;
    String contentKey = item.PopupContent?.EncryptKey();
    <div class="d-flex" onclick="showContent('@Html.Raw(contentKey)');">
        @if (item.ActionName != null && File.Exists(actionPath = WebApp.MapPath(item.ActionName)))
        {
            @Html.Raw(File.ReadAllText(actionPath));
        }
        else
        {
            <div>
                <a class="icon icon-l bg-beyond-dark color-beyondwhite-dark rounded-m shadow-xl">
                    <i class="fa-solid fa-wrench font-24"></i>
                </a>
            </div>
            <div class="align-self-center ps-3">
                <h5 class="font-600 font-17 mb-2 letter-spacing-1">系統公告</h5>
                <span class="font-15 color-theme letter-spacing-1">
                    @Html.Raw(item.Title)
                </span>
                <span class="color-theme d-block text-end font-13 mt-2 opacity-40">@($"{item.StartDate:yyyy/MM/dd}")</span>
            </div>
        }
        @if (contentKey != null)
        {
            <div class="align-self-center ms-auto me-3">
            </div>
            <div class="align-self-center">
                <i class="fa fa-angle-right color-highlight font-16"></i>
            </div>
        }
    </div>
    <div class="divider mt-4 mb-4"></div>
}
